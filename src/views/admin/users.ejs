<%- include ('adminHeader') %>

<style>
  .table-bordered {
    border: 1px solid #000000;
  }

  .table-bordered th,
  .table-bordered td {
    border: 1px solid #000000;
  }

  #userSearch {
    border: 1.5px solid #d1d1d1 !important;
    border-radius: 6px;
    background-color: #ffffff;
    padding: 10px 14px;
  }

  #userSearch:focus {
    border-color: #000000 !important;
    box-shadow: none !important;
  }
</style>

<section class="content-main">
  <div class="content-header">
    <div>
      <h1 class="content-title card-title">Users</h1>
      <p>Users List</p>
    </div>
  </div>

  <div class="col-lg-4 mb-3">
    <input
      type="text"
      id="userSearch"
      class="form-control"
      placeholder="Search users..."
      value="<%= locals.search || '' %>"
    />
  </div>

  <div class="col-lg-12 mt-2">
    <div class="table-responsive">
      <% if(locals.users != "") { %>
      <table class="table table-bordered mt-2 text-center">
        <thead>
          <tr class="table-primary">
            <th>SL.NO.</th>
            <th>UserName</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <% let itemNumber = (locals.currentPage - 1) * locals.limit + 1; %> <%
          for(let i = 0; i < locals.users.length; i++, itemNumber++) { %>
          <tr>
            <td><%= itemNumber %></td>
            <td><%= locals.users[i].username %></td>
            <td><%= locals.users[i].email %></td>
            <td><%= locals.users[i].phone %></td>
            <td><%= locals.users[i].status ? "Active" : "Blocked" %></td>
            <td>
              <button
                class="badge rounded-pill alert-warning block"
                style="color: #a85a0b; border: 0px; background-color: #f9ba7a"
                onclick="UserStatusConfirmation('<%= locals.users[i]._id %>')"
              >
                <%= locals.users[i].status ? 'Block' : 'Unblock' %>
              </button>
            </td>
          </tr>
          <% } %>
        </tbody>
      </table>
      <% } else { %>
      <h1 class="text-center text-secondary mt-5">
        No Users found
      </h1>
      <% } %>
    </div>
  </div>

  <!------- Pagination ------->
  <nav
    aria-label="Page navigation example"
    class="d-flex justify-content-centre my-4"
  >
    <ul class="pagination">
      <% if(locals.hasPreviousPage) { %>
      <li class="page-item">
        <a
          class="page-link"
          href="/admin/users?page=1&search=<%= locals.search %>"
          >First</a
        >
      </li>
      <li class="page-item">
        <a
          class="page-link"
          href="/admin/users?page=<%= locals.previousPage %>&search=<%= locals.search %>"
          >Previous</a
        >
      </li>
      <% } else { %>
      <li class="page-item disabled"><span class="page-link">First</span></li>
      <li class="page-item disabled">
        <span class="page-link">Previous</span>
      </li>
      <% } %> <% for(let i = 1; i <= locals.totalPages; i++) { %>
      <li class="page-item <%= locals.currentPage === i ? 'active' : '' %>">
        <a
          class="page-link"
          href="/admin/users?page=<%= i %>&search=<%= locals.search %>"
          ><%= i %></a
        >
      </li>
      <% } %> <% if(locals.hasNextPage) { %>
      <li class="page-item">
        <a
          class="page-link"
          href="/admin/users?page=<%= locals.nextPage %>&search=<%= locals.search %>"
          >Next</a
        >
      </li>
      <li class="page-item">
        <a
          class="page-link"
          href="/admin/users?page=<%= locals.lastPage %>&search=<%= locals.search %>"
          >Last</a
        >
      </li>
      <% } else { %>
      <li class="page-item disabled"><span class="page-link">Next</span></li>
      <li class="page-item disabled"><span class="page-link">Last</span></li>
      <% } %>
    </ul>
  </nav>
</section>

<!-- Block / Unblock Confirmation -->
<script>
  function UserStatusConfirmation(itemId) {
    Swal.fire({
      title: "Are you sure?",
      text: "Are you sure you want to proceed?",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      confirmButtonText: "Confirm",
      cancelButtonText: "Cancel",
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = "/admin/userblock/" + itemId;
      }
    });
  }
</script>

<!-- ðŸ”¥ Debounced Search Script -->
<script>
  let debounceTimer;

  document.getElementById("userSearch").addEventListener("input", function () {
    clearTimeout(debounceTimer);

    debounceTimer = setTimeout(() => {
      const searchValue = this.value;
      window.location.href = `/admin/users?search=${searchValue}`;
    }, 500);
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

<%- include ('adminfooter') %>
